<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#0b6b47">
  <title>Aapoorti Audit Manager</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<nav class="navbar navbar-expand-lg app-header mb-4">
  <div class="container">
    <a class="navbar-brand" href="{{ url_for('dashboard') }}">Aapoorti Audit Manager</a>
    <div class="d-flex gap-2 align-items-center">
      {% if session_user %}
        <span class="header-user">{{ session_user['name'] }} ({{ session_user['role'] }})</span>
        <a class="btn btn-sm btn-light header-logout" href="{{ url_for('logout') }}">Logout</a>
      {% endif %}
    </div>
  </div>
</nav>
{% set is_admin_area = session_user and session_user['role'] == 'admin' and request.path.startswith('/admin') %}
{% if is_admin_area %}
<div class="container-fluid admin-shell pb-4">
  <div class="row g-3">
    <aside class="col-12 col-lg-3 col-xl-2">
      <div class="card p-3 admin-sidebar">
        <div class="small text-uppercase fw-semibold text-muted mb-2">Admin Menu</div>
        <a class="admin-nav-link {% if request.path == '/admin/audits' %}active{% endif %}" href="{{ url_for('admin_audits') }}">Audits</a>
        <a class="admin-nav-link {% if request.path == '/admin/audits/new' %}active{% endif %}" href="{{ url_for('admin_audit_new') }}">Create Audit</a>
        <a class="admin-nav-link {% if request.path == '/admin/analytics' %}active{% endif %}" href="{{ url_for('admin_analytics') }}">Analytics</a>
        <a class="admin-nav-link {% if request.path == '/admin/history' %}active{% endif %}" href="{{ url_for('admin_history') }}">History</a>
        <a class="admin-nav-link {% if request.path == '/admin/scanner-feedback' %}active{% endif %}" href="{{ url_for('admin_scanner_feedback') }}">Scanner Feedback</a>
        <a class="admin-nav-link {% if request.path == '/admin/users' %}active{% endif %}" href="{{ url_for('admin_users') }}">Manage Users</a>
      </div>
    </aside>
    <main class="col-12 col-lg-9 col-xl-10">
{% else %}
<div class="container pb-4">
{% endif %}
{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }}">{{ message }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}
{% block content %}{% endblock %}
{% if is_admin_area %}
    </main>
  </div>
</div>
{% else %}
</div>
{% endif %}
{% if session_user %}
<nav class="mobile-tray d-md-none">
  {% if session_user['role'] == 'admin' %}
    <a class="tray-link {% if request.path.startswith('/admin/audits') %}active{% endif %}" href="{{ url_for('admin_audits') }}">Audits</a>
    <a class="tray-link {% if request.path.startswith('/admin/analytics') %}active{% endif %}" href="{{ url_for('admin_analytics') }}">Analytics</a>
    <a class="tray-link {% if request.path.startswith('/admin/users') %}active{% endif %}" href="{{ url_for('admin_users') }}">Users</a>
  {% elif session_user['role'] == 'outlet_head' %}
    <a class="tray-link {% if request.path.startswith('/outlet/audits') %}active{% endif %}" href="{{ url_for('outlet_audits') }}">Audits</a>
    <a class="tray-link {% if request.path.startswith('/outlet/analytics') %}active{% endif %}" href="{{ url_for('outlet_analytics') }}">Analytics</a>
    <a class="tray-link {% if request.path.startswith('/dashboard') %}active{% endif %}" href="{{ url_for('dashboard') }}">Home</a>
  {% elif session_user['role'] == 'sub_auditor' %}
    <a class="tray-link {% if request.path.startswith('/sub/assignments') %}active{% endif %}" href="{{ url_for('sub_assignments') }}">Assignments</a>
    <a class="tray-link {% if request.path.startswith('/dashboard') %}active{% endif %}" href="{{ url_for('dashboard') }}">Home</a>
    {% set scan_target = request.path if request.path.startswith('/sub/assignments/') and request.path.endswith('/scan') else url_for('sub_assignments') %}
    <a class="tray-link {% if request.path.endswith('/scan') %}active{% endif %}" href="{{ scan_target }}">Scan</a>
  {% endif %}
  <a class="tray-link" href="{{ url_for('logout') }}">Logout</a>
</nav>
{% endif %}
</body>
</html>
